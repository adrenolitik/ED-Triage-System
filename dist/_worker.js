var vt=Object.defineProperty;var $e=e=>{throw TypeError(e)};var Rt=(e,t,s)=>t in e?vt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var p=(e,t,s)=>Rt(e,typeof t!="symbol"?t+"":t,s),Ne=(e,t,s)=>t.has(e)||$e("Cannot "+s);var o=(e,t,s)=>(Ne(e,t,"read from private field"),s?s.call(e):t.get(e)),m=(e,t,s)=>t.has(e)?$e("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),f=(e,t,s,r)=>(Ne(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),y=(e,t,s)=>(Ne(e,t,"access private method"),s);var qe=(e,t,s,r)=>({set _(n){f(e,t,n,s)},get _(){return o(e,t,r)}});var Be=(e,t,s)=>(r,n)=>{let i=-1;return a(0);async function a(u){if(u<=i)throw new Error("next() called multiple times");i=u;let c,l=!1,h;if(e[u]?(h=e[u][0][0],r.req.routeIndex=u):h=u===e.length&&n||void 0,h)try{c=await h(r,()=>a(u+1))}catch(d){if(d instanceof Error&&t)r.error=d,c=await t(d,r),l=!0;else throw d}else r.finalized===!1&&s&&(c=await s(r));return c&&(r.finalized===!1||l)&&(r.res=c),r}},St=Symbol(),bt=async(e,t=Object.create(null))=>{const{all:s=!1,dot:r=!1}=t,i=(e instanceof at?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?_t(e,{all:s,dot:r}):{}};async function _t(e,t){const s=await e.formData();return s?Ot(s,t):{}}function Ot(e,t){const s=Object.create(null);return e.forEach((r,n)=>{t.all||n.endsWith("[]")?Tt(s,n,r):s[n]=r}),t.dot&&Object.entries(s).forEach(([r,n])=>{r.includes(".")&&(jt(s,r,n),delete s[r])}),s}var Tt=(e,t,s)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(s):e[t]=[e[t],s]:t.endsWith("[]")?e[t]=[s]:e[t]=s},jt=(e,t,s)=>{let r=e;const n=t.split(".");n.forEach((i,a)=>{a===n.length-1?r[i]=s:((!r[i]||typeof r[i]!="object"||Array.isArray(r[i])||r[i]instanceof File)&&(r[i]=Object.create(null)),r=r[i])})},tt=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},At=e=>{const{groups:t,path:s}=Ct(e),r=tt(s);return Nt(r,t)},Ct=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(s,r)=>{const n=`@${r}`;return t.push([n,s]),n}),{groups:t,path:e}},Nt=(e,t)=>{for(let s=t.length-1;s>=0;s--){const[r]=t[s];for(let n=e.length-1;n>=0;n--)if(e[n].includes(r)){e[n]=e[n].replace(r,t[s][1]);break}}return e},Re={},Pt=(e,t)=>{if(e==="*")return"*";const s=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(s){const r=`${e}#${t}`;return Re[r]||(s[2]?Re[r]=t&&t[0]!==":"&&t[0]!=="*"?[r,s[1],new RegExp(`^${s[2]}(?=/${t})`)]:[e,s[1],new RegExp(`^${s[2]}$`)]:Re[r]=[e,s[1],!0]),Re[r]}return null},Me=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,s=>{try{return t(s)}catch{return s}})}},It=e=>Me(e,decodeURI),rt=e=>{const t=e.url,s=t.indexOf("/",t.indexOf(":")+4);let r=s;for(;r<t.length;r++){const n=t.charCodeAt(r);if(n===37){const i=t.indexOf("?",r),a=t.slice(s,i===-1?void 0:i);return It(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return t.slice(s,r)},Dt=e=>{const t=rt(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},te=(e,t,...s)=>(s.length&&(t=te(t,...s)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),st=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),s=[];let r="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))r+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){s.length===0&&r===""?s.push("/"):s.push(r);const i=n.replace("?","");r+="/"+i,s.push(r)}else r+="/"+n}),s.filter((n,i,a)=>a.indexOf(n)===i)},Pe=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Me(e,it):e):e,nt=(e,t,s)=>{let r;if(!s&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);for(a===-1&&(a=e.indexOf(`&${t}`,8));a!==-1;){const u=e.charCodeAt(a+t.length+1);if(u===61){const c=a+t.length+2,l=e.indexOf("&",c);return Pe(e.slice(c,l===-1?void 0:l))}else if(u==38||isNaN(u))return"";a=e.indexOf(`&${t}`,a+1)}if(r=/[%+]/.test(e),!r)return}const n={};r??(r=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const a=e.indexOf("&",i+1);let u=e.indexOf("=",i);u>a&&a!==-1&&(u=-1);let c=e.slice(i+1,u===-1?a===-1?void 0:a:u);if(r&&(c=Pe(c)),i=a,c==="")continue;let l;u===-1?l="":(l=e.slice(u+1,a===-1?void 0:a),r&&(l=Pe(l))),s?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(l)):n[c]??(n[c]=l)}return t?n[t]:n},Ht=nt,Mt=(e,t)=>nt(e,t,!0),it=decodeURIComponent,ke=e=>Me(e,it),ne,j,F,ot,ct,De,q,Ve,at=(Ve=class{constructor(e,t="/",s=[[]]){m(this,F);p(this,"raw");m(this,ne);m(this,j);p(this,"routeIndex",0);p(this,"path");p(this,"bodyCache",{});m(this,q,e=>{const{bodyCache:t,raw:s}=this,r=t[e];if(r)return r;const n=Object.keys(t)[0];return n?t[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=s[e]()});this.raw=e,this.path=t,f(this,j,s),f(this,ne,{})}param(e){return e?y(this,F,ot).call(this,e):y(this,F,ct).call(this)}query(e){return Ht(this.url,e)}queries(e){return Mt(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((s,r)=>{t[r]=s}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await bt(this,e))}json(){return o(this,q).call(this,"text").then(e=>JSON.parse(e))}text(){return o(this,q).call(this,"text")}arrayBuffer(){return o(this,q).call(this,"arrayBuffer")}blob(){return o(this,q).call(this,"blob")}formData(){return o(this,q).call(this,"formData")}addValidatedData(e,t){o(this,ne)[e]=t}valid(e){return o(this,ne)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[St](){return o(this,j)}get matchedRoutes(){return o(this,j)[0].map(([[,e]])=>e)}get routePath(){return o(this,j)[0].map(([[,e]])=>e)[this.routeIndex].path}},ne=new WeakMap,j=new WeakMap,F=new WeakSet,ot=function(e){const t=o(this,j)[0][this.routeIndex][1][e],s=y(this,F,De).call(this,t);return s&&/\%/.test(s)?ke(s):s},ct=function(){const e={},t=Object.keys(o(this,j)[0][this.routeIndex][1]);for(const s of t){const r=y(this,F,De).call(this,o(this,j)[0][this.routeIndex][1][s]);r!==void 0&&(e[s]=/\%/.test(r)?ke(r):r)}return e},De=function(e){return o(this,j)[1]?o(this,j)[1][e]:e},q=new WeakMap,Ve),Lt={Stringify:1},lt=async(e,t,s,r,n)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const i=e.callbacks;return i!=null&&i.length?(n?n[0]+=e:n=[e],Promise.all(i.map(u=>u({phase:t,buffer:n,context:r}))).then(u=>Promise.all(u.filter(Boolean).map(c=>lt(c,t,!1,r,n))).then(()=>n[0]))):Promise.resolve(e)},Ft="text/plain; charset=UTF-8",Ie=(e,t)=>({"Content-Type":e,...t}),pe,ge,D,ie,H,T,me,ae,oe,K,Ee,ye,B,re,Ge,$t=(Ge=class{constructor(e,t){m(this,B);m(this,pe);m(this,ge);p(this,"env",{});m(this,D);p(this,"finalized",!1);p(this,"error");m(this,ie);m(this,H);m(this,T);m(this,me);m(this,ae);m(this,oe);m(this,K);m(this,Ee);m(this,ye);p(this,"render",(...e)=>(o(this,ae)??f(this,ae,t=>this.html(t)),o(this,ae).call(this,...e)));p(this,"setLayout",e=>f(this,me,e));p(this,"getLayout",()=>o(this,me));p(this,"setRenderer",e=>{f(this,ae,e)});p(this,"header",(e,t,s)=>{this.finalized&&f(this,T,new Response(o(this,T).body,o(this,T)));const r=o(this,T)?o(this,T).headers:o(this,K)??f(this,K,new Headers);t===void 0?r.delete(e):s!=null&&s.append?r.append(e,t):r.set(e,t)});p(this,"status",e=>{f(this,ie,e)});p(this,"set",(e,t)=>{o(this,D)??f(this,D,new Map),o(this,D).set(e,t)});p(this,"get",e=>o(this,D)?o(this,D).get(e):void 0);p(this,"newResponse",(...e)=>y(this,B,re).call(this,...e));p(this,"body",(e,t,s)=>y(this,B,re).call(this,e,t,s));p(this,"text",(e,t,s)=>!o(this,K)&&!o(this,ie)&&!t&&!s&&!this.finalized?new Response(e):y(this,B,re).call(this,e,t,Ie(Ft,s)));p(this,"json",(e,t,s)=>y(this,B,re).call(this,JSON.stringify(e),t,Ie("application/json",s)));p(this,"html",(e,t,s)=>{const r=n=>y(this,B,re).call(this,n,t,Ie("text/html; charset=UTF-8",s));return typeof e=="object"?lt(e,Lt.Stringify,!1,{}).then(r):r(e)});p(this,"redirect",(e,t)=>{const s=String(e);return this.header("Location",/[^\x00-\xFF]/.test(s)?encodeURI(s):s),this.newResponse(null,t??302)});p(this,"notFound",()=>(o(this,oe)??f(this,oe,()=>new Response),o(this,oe).call(this,this)));f(this,pe,e),t&&(f(this,H,t.executionCtx),this.env=t.env,f(this,oe,t.notFoundHandler),f(this,ye,t.path),f(this,Ee,t.matchResult))}get req(){return o(this,ge)??f(this,ge,new at(o(this,pe),o(this,ye),o(this,Ee))),o(this,ge)}get event(){if(o(this,H)&&"respondWith"in o(this,H))return o(this,H);throw Error("This context has no FetchEvent")}get executionCtx(){if(o(this,H))return o(this,H);throw Error("This context has no ExecutionContext")}get res(){return o(this,T)||f(this,T,new Response(null,{headers:o(this,K)??f(this,K,new Headers)}))}set res(e){if(o(this,T)&&e){e=new Response(e.body,e);for(const[t,s]of o(this,T).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const r=o(this,T).headers.getSetCookie();e.headers.delete("set-cookie");for(const n of r)e.headers.append("set-cookie",n)}else e.headers.set(t,s)}f(this,T,e),this.finalized=!0}get var(){return o(this,D)?Object.fromEntries(o(this,D)):{}}},pe=new WeakMap,ge=new WeakMap,D=new WeakMap,ie=new WeakMap,H=new WeakMap,T=new WeakMap,me=new WeakMap,ae=new WeakMap,oe=new WeakMap,K=new WeakMap,Ee=new WeakMap,ye=new WeakMap,B=new WeakSet,re=function(e,t,s){const r=o(this,T)?new Headers(o(this,T).headers):o(this,K)??new Headers;if(typeof t=="object"&&"headers"in t){const i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[a,u]of i)a.toLowerCase()==="set-cookie"?r.append(a,u):r.set(a,u)}if(s)for(const[i,a]of Object.entries(s))if(typeof a=="string")r.set(i,a);else{r.delete(i);for(const u of a)r.append(i,u)}const n=typeof t=="number"?t:(t==null?void 0:t.status)??o(this,ie);return new Response(e,{status:n,headers:r})},Ge),R="ALL",qt="all",Bt=["get","post","put","delete","options","patch"],ut="Can not add a route since the matcher is already built.",ht=class extends Error{},kt="__COMPOSED_HANDLER",Ut=e=>e.text("404 Not Found",404),Ue=(e,t)=>{if("getResponse"in e){const s=e.getResponse();return t.newResponse(s.body,s)}return console.error(e),t.text("Internal Server Error",500)},A,S,ft,C,V,Se,be,Ke,dt=(Ke=class{constructor(t={}){m(this,S);p(this,"get");p(this,"post");p(this,"put");p(this,"delete");p(this,"options");p(this,"patch");p(this,"all");p(this,"on");p(this,"use");p(this,"router");p(this,"getPath");p(this,"_basePath","/");m(this,A,"/");p(this,"routes",[]);m(this,C,Ut);p(this,"errorHandler",Ue);p(this,"onError",t=>(this.errorHandler=t,this));p(this,"notFound",t=>(f(this,C,t),this));p(this,"fetch",(t,...s)=>y(this,S,be).call(this,t,s[1],s[0],t.method));p(this,"request",(t,s,r,n)=>t instanceof Request?this.fetch(s?new Request(t,s):t,r,n):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${te("/",t)}`,s),r,n)));p(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(y(this,S,be).call(this,t.request,t,void 0,t.request.method))})});[...Bt,qt].forEach(i=>{this[i]=(a,...u)=>(typeof a=="string"?f(this,A,a):y(this,S,V).call(this,i,o(this,A),a),u.forEach(c=>{y(this,S,V).call(this,i,o(this,A),c)}),this)}),this.on=(i,a,...u)=>{for(const c of[a].flat()){f(this,A,c);for(const l of[i].flat())u.map(h=>{y(this,S,V).call(this,l.toUpperCase(),o(this,A),h)})}return this},this.use=(i,...a)=>(typeof i=="string"?f(this,A,i):(f(this,A,"*"),a.unshift(i)),a.forEach(u=>{y(this,S,V).call(this,R,o(this,A),u)}),this);const{strict:r,...n}=t;Object.assign(this,n),this.getPath=r??!0?t.getPath??rt:Dt}route(t,s){const r=this.basePath(t);return s.routes.map(n=>{var a;let i;s.errorHandler===Ue?i=n.handler:(i=async(u,c)=>(await Be([],s.errorHandler)(u,()=>n.handler(u,c))).res,i[kt]=n.handler),y(a=r,S,V).call(a,n.method,n.path,i)}),this}basePath(t){const s=y(this,S,ft).call(this);return s._basePath=te(this._basePath,t),s}mount(t,s,r){let n,i;r&&(typeof r=="function"?i=r:(i=r.optionHandler,r.replaceRequest===!1?n=c=>c:n=r.replaceRequest));const a=i?c=>{const l=i(c);return Array.isArray(l)?l:[l]}:c=>{let l;try{l=c.executionCtx}catch{}return[c.env,l]};n||(n=(()=>{const c=te(this._basePath,t),l=c==="/"?0:c.length;return h=>{const d=new URL(h.url);return d.pathname=d.pathname.slice(l)||"/",new Request(d,h)}})());const u=async(c,l)=>{const h=await s(n(c.req.raw),...a(c));if(h)return h;await l()};return y(this,S,V).call(this,R,te(t,"*"),u),this}},A=new WeakMap,S=new WeakSet,ft=function(){const t=new dt({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,f(t,C,o(this,C)),t.routes=this.routes,t},C=new WeakMap,V=function(t,s,r){t=t.toUpperCase(),s=te(this._basePath,s);const n={basePath:this._basePath,path:s,method:t,handler:r};this.router.add(t,s,[r,n]),this.routes.push(n)},Se=function(t,s){if(t instanceof Error)return this.errorHandler(t,s);throw t},be=function(t,s,r,n){if(n==="HEAD")return(async()=>new Response(null,await y(this,S,be).call(this,t,s,r,"GET")))();const i=this.getPath(t,{env:r}),a=this.router.match(n,i),u=new $t(t,{path:i,matchResult:a,env:r,executionCtx:s,notFoundHandler:o(this,C)});if(a[0].length===1){let l;try{l=a[0][0][0][0](u,async()=>{u.res=await o(this,C).call(this,u)})}catch(h){return y(this,S,Se).call(this,h,u)}return l instanceof Promise?l.then(h=>h||(u.finalized?u.res:o(this,C).call(this,u))).catch(h=>y(this,S,Se).call(this,h,u)):l??o(this,C).call(this,u)}const c=Be(a[0],this.errorHandler,o(this,C));return(async()=>{try{const l=await c(u);if(!l.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return l.res}catch(l){return y(this,S,Se).call(this,l,u)}})()},Ke),pt=[];function Wt(e,t){const s=this.buildAllMatchers(),r=(n,i)=>{const a=s[n]||s[R],u=a[2][i];if(u)return u;const c=i.match(a[0]);if(!c)return[[],pt];const l=c.indexOf("",1);return[a[1][l],c]};return this.match=r,r(e,t)}var Oe="[^/]+",de=".*",fe="(?:|/.*)",se=Symbol(),zt=new Set(".\\+*[^]$()");function Vt(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===de||e===fe?1:t===de||t===fe?-1:e===Oe?1:t===Oe?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var J,Y,N,Je,He=(Je=class{constructor(){m(this,J);m(this,Y);m(this,N,Object.create(null))}insert(t,s,r,n,i){if(t.length===0){if(o(this,J)!==void 0)throw se;if(i)return;f(this,J,s);return}const[a,...u]=t,c=a==="*"?u.length===0?["","",de]:["","",Oe]:a==="/*"?["","",fe]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let l;if(c){const h=c[1];let d=c[2]||Oe;if(h&&c[2]&&(d===".*"||(d=d.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(d))))throw se;if(l=o(this,N)[d],!l){if(Object.keys(o(this,N)).some(g=>g!==de&&g!==fe))throw se;if(i)return;l=o(this,N)[d]=new He,h!==""&&f(l,Y,n.varIndex++)}!i&&h!==""&&r.push([h,o(l,Y)])}else if(l=o(this,N)[a],!l){if(Object.keys(o(this,N)).some(h=>h.length>1&&h!==de&&h!==fe))throw se;if(i)return;l=o(this,N)[a]=new He}l.insert(u,s,r,n,i)}buildRegExpStr(){const s=Object.keys(o(this,N)).sort(Vt).map(r=>{const n=o(this,N)[r];return(typeof o(n,Y)=="number"?`(${r})@${o(n,Y)}`:zt.has(r)?`\\${r}`:r)+n.buildRegExpStr()});return typeof o(this,J)=="number"&&s.unshift(`#${o(this,J)}`),s.length===0?"":s.length===1?s[0]:"(?:"+s.join("|")+")"}},J=new WeakMap,Y=new WeakMap,N=new WeakMap,Je),Te,we,Ye,Gt=(Ye=class{constructor(){m(this,Te,{varIndex:0});m(this,we,new He)}insert(e,t,s){const r=[],n=[];for(let a=0;;){let u=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{const l=`@\\${a}`;return n[a]=[l,c],a++,u=!0,l}),!u)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){const[u]=n[a];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(u)!==-1){i[c]=i[c].replace(u,n[a][1]);break}}return o(this,we).insert(i,t,r,o(this,Te),s),r}buildRegExp(){let e=o(this,we).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const s=[],r=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>i!==void 0?(s[++t]=Number(i),"$()"):(a!==void 0&&(r[Number(a)]=++t),"")),[new RegExp(`^${e}`),s,r]}},Te=new WeakMap,we=new WeakMap,Ye),Kt=[/^$/,[],Object.create(null)],_e=Object.create(null);function gt(e){return _e[e]??(_e[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,s)=>s?`\\${s}`:"(?:|/.*)")}$`))}function Jt(){_e=Object.create(null)}function Yt(e){var l;const t=new Gt,s=[];if(e.length===0)return Kt;const r=e.map(h=>[!/\*|\/:/.test(h[0]),...h]).sort(([h,d],[g,x])=>h?1:g?-1:d.length-x.length),n=Object.create(null);for(let h=0,d=-1,g=r.length;h<g;h++){const[x,w,E]=r[h];x?n[w]=[E.map(([O])=>[O,Object.create(null)]),pt]:d++;let v;try{v=t.insert(w,d,x)}catch(O){throw O===se?new ht(w):O}x||(s[d]=E.map(([O,Z])=>{const le=Object.create(null);for(Z-=1;Z>=0;Z--){const[P,Ae]=v[Z];le[P]=Ae}return[O,le]}))}const[i,a,u]=t.buildRegExp();for(let h=0,d=s.length;h<d;h++)for(let g=0,x=s[h].length;g<x;g++){const w=(l=s[h][g])==null?void 0:l[1];if(!w)continue;const E=Object.keys(w);for(let v=0,O=E.length;v<O;v++)w[E[v]]=u[w[E[v]]]}const c=[];for(const h in a)c[h]=s[a[h]];return[i,c,n]}function ee(e,t){if(e){for(const s of Object.keys(e).sort((r,n)=>n.length-r.length))if(gt(s).test(t))return[...e[s]]}}var k,U,je,mt,Xe,Xt=(Xe=class{constructor(){m(this,je);p(this,"name","RegExpRouter");m(this,k);m(this,U);p(this,"match",Wt);f(this,k,{[R]:Object.create(null)}),f(this,U,{[R]:Object.create(null)})}add(e,t,s){var u;const r=o(this,k),n=o(this,U);if(!r||!n)throw new Error(ut);r[e]||[r,n].forEach(c=>{c[e]=Object.create(null),Object.keys(c[R]).forEach(l=>{c[e][l]=[...c[R][l]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const c=gt(t);e===R?Object.keys(r).forEach(l=>{var h;(h=r[l])[t]||(h[t]=ee(r[l],t)||ee(r[R],t)||[])}):(u=r[e])[t]||(u[t]=ee(r[e],t)||ee(r[R],t)||[]),Object.keys(r).forEach(l=>{(e===R||e===l)&&Object.keys(r[l]).forEach(h=>{c.test(h)&&r[l][h].push([s,i])})}),Object.keys(n).forEach(l=>{(e===R||e===l)&&Object.keys(n[l]).forEach(h=>c.test(h)&&n[l][h].push([s,i]))});return}const a=st(t)||[t];for(let c=0,l=a.length;c<l;c++){const h=a[c];Object.keys(n).forEach(d=>{var g;(e===R||e===d)&&((g=n[d])[h]||(g[h]=[...ee(r[d],h)||ee(r[R],h)||[]]),n[d][h].push([s,i-l+c+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(o(this,U)).concat(Object.keys(o(this,k))).forEach(t=>{e[t]||(e[t]=y(this,je,mt).call(this,t))}),f(this,k,f(this,U,void 0)),Jt(),e}},k=new WeakMap,U=new WeakMap,je=new WeakSet,mt=function(e){const t=[];let s=e===R;return[o(this,k),o(this,U)].forEach(r=>{const n=r[e]?Object.keys(r[e]).map(i=>[i,r[e][i]]):[];n.length!==0?(s||(s=!0),t.push(...n)):e!==R&&t.push(...Object.keys(r[R]).map(i=>[i,r[R][i]]))}),s?Yt(t):null},Xe),W,M,Qe,Qt=(Qe=class{constructor(e){p(this,"name","SmartRouter");m(this,W,[]);m(this,M,[]);f(this,W,e.routers)}add(e,t,s){if(!o(this,M))throw new Error(ut);o(this,M).push([e,t,s])}match(e,t){if(!o(this,M))throw new Error("Fatal error");const s=o(this,W),r=o(this,M),n=s.length;let i=0,a;for(;i<n;i++){const u=s[i];try{for(let c=0,l=r.length;c<l;c++)u.add(...r[c]);a=u.match(e,t)}catch(c){if(c instanceof ht)continue;throw c}this.match=u.match.bind(u),f(this,W,[u]),f(this,M,void 0);break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(o(this,M)||o(this,W).length!==1)throw new Error("No active router has been determined yet.");return o(this,W)[0]}},W=new WeakMap,M=new WeakMap,Qe),he=Object.create(null),z,_,X,ce,b,L,G,Ze,Et=(Ze=class{constructor(e,t,s){m(this,L);m(this,z);m(this,_);m(this,X);m(this,ce,0);m(this,b,he);if(f(this,_,s||Object.create(null)),f(this,z,[]),e&&t){const r=Object.create(null);r[e]={handler:t,possibleKeys:[],score:0},f(this,z,[r])}f(this,X,[])}insert(e,t,s){f(this,ce,++qe(this,ce)._);let r=this;const n=At(t),i=[];for(let a=0,u=n.length;a<u;a++){const c=n[a],l=n[a+1],h=Pt(c,l),d=Array.isArray(h)?h[0]:c;if(d in o(r,_)){r=o(r,_)[d],h&&i.push(h[1]);continue}o(r,_)[d]=new Et,h&&(o(r,X).push(h),i.push(h[1])),r=o(r,_)[d]}return o(r,z).push({[e]:{handler:s,possibleKeys:i.filter((a,u,c)=>c.indexOf(a)===u),score:o(this,ce)}}),r}search(e,t){var u;const s=[];f(this,b,he);let n=[this];const i=tt(t),a=[];for(let c=0,l=i.length;c<l;c++){const h=i[c],d=c===l-1,g=[];for(let x=0,w=n.length;x<w;x++){const E=n[x],v=o(E,_)[h];v&&(f(v,b,o(E,b)),d?(o(v,_)["*"]&&s.push(...y(this,L,G).call(this,o(v,_)["*"],e,o(E,b))),s.push(...y(this,L,G).call(this,v,e,o(E,b)))):g.push(v));for(let O=0,Z=o(E,X).length;O<Z;O++){const le=o(E,X)[O],P=o(E,b)===he?{}:{...o(E,b)};if(le==="*"){const $=o(E,_)["*"];$&&(s.push(...y(this,L,G).call(this,$,e,o(E,b))),f($,b,P),g.push($));continue}const[Ae,Fe,ue]=le;if(!h&&!(ue instanceof RegExp))continue;const I=o(E,_)[Ae],xt=i.slice(c).join("/");if(ue instanceof RegExp){const $=ue.exec(xt);if($){if(P[Fe]=$[0],s.push(...y(this,L,G).call(this,I,e,o(E,b),P)),Object.keys(o(I,_)).length){f(I,b,P);const Ce=((u=$[0].match(/\//))==null?void 0:u.length)??0;(a[Ce]||(a[Ce]=[])).push(I)}continue}}(ue===!0||ue.test(h))&&(P[Fe]=h,d?(s.push(...y(this,L,G).call(this,I,e,P,o(E,b))),o(I,_)["*"]&&s.push(...y(this,L,G).call(this,o(I,_)["*"],e,P,o(E,b)))):(f(I,b,P),g.push(I)))}}n=g.concat(a.shift()??[])}return s.length>1&&s.sort((c,l)=>c.score-l.score),[s.map(({handler:c,params:l})=>[c,l])]}},z=new WeakMap,_=new WeakMap,X=new WeakMap,ce=new WeakMap,b=new WeakMap,L=new WeakSet,G=function(e,t,s,r){const n=[];for(let i=0,a=o(e,z).length;i<a;i++){const u=o(e,z)[i],c=u[t]||u[R],l={};if(c!==void 0&&(c.params=Object.create(null),n.push(c),s!==he||r&&r!==he))for(let h=0,d=c.possibleKeys.length;h<d;h++){const g=c.possibleKeys[h],x=l[c.score];c.params[g]=r!=null&&r[g]&&!x?r[g]:s[g]??(r==null?void 0:r[g]),l[c.score]=!0}}return n},Ze),Q,et,Zt=(et=class{constructor(){p(this,"name","TrieRouter");m(this,Q);f(this,Q,new Et)}add(e,t,s){const r=st(t);if(r){for(let n=0,i=r.length;n<i;n++)o(this,Q).insert(e,r[n],s);return}o(this,Q).insert(e,t,s)}match(e,t){return o(this,Q).search(e,t)}},Q=new WeakMap,et),Le=class extends dt{constructor(e={}){super(e),this.router=e.router??new Qt({routers:[new Xt,new Zt]})}},er=e=>{const s={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},r=(i=>typeof i=="string"?i==="*"?()=>i:a=>i===a?a:null:typeof i=="function"?i:a=>i.includes(a)?a:null)(s.origin),n=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(s.allowMethods);return async function(a,u){var h;function c(d,g){a.res.headers.set(d,g)}const l=await r(a.req.header("origin")||"",a);if(l&&c("Access-Control-Allow-Origin",l),s.credentials&&c("Access-Control-Allow-Credentials","true"),(h=s.exposeHeaders)!=null&&h.length&&c("Access-Control-Expose-Headers",s.exposeHeaders.join(",")),a.req.method==="OPTIONS"){s.origin!=="*"&&c("Vary","Origin"),s.maxAge!=null&&c("Access-Control-Max-Age",s.maxAge.toString());const d=await n(a.req.header("origin")||"",a);d.length&&c("Access-Control-Allow-Methods",d.join(","));let g=s.allowHeaders;if(!(g!=null&&g.length)){const x=a.req.header("Access-Control-Request-Headers");x&&(g=x.split(/\s*,\s*/))}return g!=null&&g.length&&(c("Access-Control-Allow-Headers",g.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await u(),s.origin!=="*"&&a.header("Vary","Origin",{append:!0})}},tr=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,We=(e,t=sr)=>{const s=/\.([a-zA-Z0-9]+?)$/,r=e.match(s);if(!r)return;let n=t[r[1]];return n&&n.startsWith("text")&&(n+="; charset=utf-8"),n},rr={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},sr=rr,nr=(...e)=>{let t=e.filter(n=>n!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const s=t.split("/"),r=[];for(const n of s)n===".."&&r.length>0&&r.at(-1)!==".."?r.pop():n!=="."&&r.push(n);return r.join("/")||"."},yt={br:".br",zstd:".zst",gzip:".gz"},ir=Object.keys(yt),ar="index.html",or=e=>{const t=e.root??"./",s=e.path,r=e.join??nr;return async(n,i)=>{var h,d,g,x;if(n.finalized)return i();let a;if(e.path)a=e.path;else try{if(a=decodeURIComponent(n.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(a))throw new Error}catch{return await((h=e.onNotFound)==null?void 0:h.call(e,n.req.path,n)),i()}let u=r(t,!s&&e.rewriteRequestPath?e.rewriteRequestPath(a):a);e.isDir&&await e.isDir(u)&&(u=r(u,ar));const c=e.getContent;let l=await c(u,n);if(l instanceof Response)return n.newResponse(l.body,l);if(l){const w=e.mimes&&We(u,e.mimes)||We(u);if(n.header("Content-Type",w||"application/octet-stream"),e.precompressed&&(!w||tr.test(w))){const E=new Set((d=n.req.header("Accept-Encoding"))==null?void 0:d.split(",").map(v=>v.trim()));for(const v of ir){if(!E.has(v))continue;const O=await c(u+yt[v],n);if(O){l=O,n.header("Content-Encoding",v),n.header("Vary","Accept-Encoding",{append:!0});break}}}return await((g=e.onFound)==null?void 0:g.call(e,u,n)),n.body(l)}await((x=e.onNotFound)==null?void 0:x.call(e,u,n)),await i()}},cr=async(e,t)=>{let s;t&&t.manifest?typeof t.manifest=="string"?s=JSON.parse(t.manifest):s=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?s=JSON.parse(__STATIC_CONTENT_MANIFEST):s=__STATIC_CONTENT_MANIFEST;let r;t&&t.namespace?r=t.namespace:r=__STATIC_CONTENT;const n=s[e]||e;if(!n)return null;const i=await r.get(n,{type:"stream"});return i||null},lr=e=>async function(s,r){return or({...e,getContent:async i=>cr(i,{manifest:e.manifest,namespace:e.namespace?e.namespace:s.env?s.env.__STATIC_CONTENT:void 0})})(s,r)},ur=e=>lr(e);function hr(e){let t=0;return e.respiratoryRate<=8?t+=3:e.respiratoryRate<=11?t+=1:e.respiratoryRate<=20?t+=0:e.respiratoryRate<=24?t+=2:t+=3,e.spo2<=91?t+=3:e.spo2<=93?t+=2:e.spo2<=95?t+=1:t+=0,e.oxygenSupplementation&&(t+=2),e.heartRate<=40?t+=3:e.heartRate<=50?t+=1:e.heartRate<=90?t+=0:e.heartRate<=110?t+=1:e.heartRate<=130?t+=2:t+=3,e.systolicBP<=90?t+=3:e.systolicBP<=100?t+=2:e.systolicBP<=110?t+=1:e.systolicBP<=219?t+=0:t+=3,e.temperature<=35?t+=3:e.temperature<=36?t+=1:e.temperature<=38?t+=0:e.temperature<=39?t+=1:t+=2,e.consciousnessLevel==="alert"?t+=0:t+=3,t}function dr(e){let t=0;return e.respiratoryRate<9?t+=2:e.respiratoryRate<=14?t+=0:e.respiratoryRate<=20?t+=1:e.respiratoryRate<=29?t+=2:t+=3,e.heartRate<40?t+=2:e.heartRate<=50?t+=1:e.heartRate<=100?t+=0:e.heartRate<=110?t+=1:e.heartRate<=129?t+=2:t+=3,e.systolicBP<70?t+=3:e.systolicBP<=80?t+=2:e.systolicBP<=100?t+=1:e.systolicBP<=199?t+=0:t+=2,e.temperature<35?t+=2:e.temperature<=38.4?t+=0:t+=2,e.consciousnessLevel==="alert"?t+=0:e.consciousnessLevel==="voice"?t+=1:e.consciousnessLevel==="pain"?t+=2:t+=3,t}function fr(e){let t=0;return e.respiratoryRate>=22&&(t+=1),e.consciousnessLevel!=="alert"&&(t+=1),e.systolicBP<=100&&(t+=1),t}function pr(e,t,s){const r={level:"non-urgent",color:"blue",priorityScore:0,immediateActions:[],monitoringPlan:[],investigationsNeeded:[],escalationRequired:!1};switch(r.priorityScore=Math.min(100,e.news*4+e.mews*3+e.qsofa*10),e.qsofa>=2||e.news>=7||t.consciousnessLevel==="unresponsive"||t.spo2<85||t.systolicBP<70||s.seizures?(r.level="resuscitation",r.color="red",r.priorityScore=Math.max(r.priorityScore,90),r.escalationRequired=!0,r.immediateActions.push("Немедленная помощь реаниматолога","Обеспечить проходимость дыхательных путей","Подача высокопоточного кислорода","Венозный доступ и инфузионная терапия","Мониторинг витальных функций"),r.investigationsNeeded.push("ЭКГ","КТ головы (при травме/неврологии)","Общий анализ крови, биохимия","Коагулограмма","Газы крови")):e.news>=5||e.mews>=5||s.chestPain||s.bleeding||t.spo2<90||t.systolicBP<90?(r.level="emergency",r.color="orange",r.priorityScore=Math.max(r.priorityScore,70),r.escalationRequired=!0,r.immediateActions.push("Немедленный осмотр врача (в течение 10 минут)","Подача кислорода при SpO2 < 94%","Венозный доступ","Мониторинг витальных функций каждые 15 минут"),r.investigationsNeeded.push("ЭКГ (при боли в груди)","Общий анализ крови","Биохимия крови","Рентген грудной клетки (при одышке)")):e.news>=3||e.mews>=3||s.dyspnea||s.trauma||t.temperature>38.5||t.temperature<36?(r.level="urgent",r.color="yellow",r.priorityScore=Math.max(r.priorityScore,50),r.immediateActions.push("Осмотр врача в течение 30 минут","Контроль витальных функций каждые 30 минут","Обеспечить комфорт пациента"),r.investigationsNeeded.push("Общий анализ крови","Общий анализ мочи","Рентгенография при необходимости")):e.news>0||e.mews>0?(r.level="semi-urgent",r.color="green",r.priorityScore=Math.max(r.priorityScore,30),r.immediateActions.push("Осмотр врача в течение 60 минут","Измерение витальных функций каждый час"),r.investigationsNeeded.push("Базовые анализы по показаниям")):(r.level="non-urgent",r.color="blue",r.priorityScore=Math.max(r.priorityScore,10),r.immediateActions.push("Плановый осмотр в течение 120 минут","Регистрация данных")),r.level){case"resuscitation":r.monitoringPlan.push("Непрерывный мониторинг ЭКГ, SpO2, АД","Контроль сознания каждые 5 минут","Учёт диуреза");break;case"emergency":r.monitoringPlan.push("Мониторинг витальных функций каждые 15 минут","Оценка динамики состояния каждые 30 минут");break;case"urgent":r.monitoringPlan.push("Контроль витальных функций каждые 30 минут","Переоценка через 1 час");break;case"semi-urgent":r.monitoringPlan.push("Контроль витальных функций каждый час","Переоценка через 2 часа");break;default:r.monitoringPlan.push("Базовый мониторинг","Переоценка при изменении состояния")}return r}const xe=new Le;xe.post("/assess",async e=>{try{const t=await e.req.json(),{patient:s,vitals:r,features:n,assessedBy:i}=t;if(!(s!=null&&s.patientId)||!r||!n)return e.json({error:"Missing required fields"},400);const a=e.env.DB,u=await a.prepare(`INSERT INTO patients (patient_id, age, gender, arrival_mode, chief_complaint)
         VALUES (?, ?, ?, ?, ?)
         ON CONFLICT(patient_id) DO UPDATE SET
           age = excluded.age,
           gender = excluded.gender,
           arrival_mode = excluded.arrival_mode,
           chief_complaint = excluded.chief_complaint,
           admission_time = CURRENT_TIMESTAMP
         RETURNING id`).bind(s.patientId,s.age||null,s.gender||null,s.arrivalMode||"walking",s.chiefComplaint||null).first();if(!u)return e.json({error:"Failed to create patient record"},500);const c=u.id,l={respiratoryRate:r.respiratoryRate,spo2:r.spo2,oxygenSupplementation:r.oxygenSupplementation||!1,heartRate:r.heartRate,systolicBP:r.systolicBP,temperature:r.temperature,consciousnessLevel:r.consciousnessLevel||"alert",gcsScore:r.gcsScore},h={chestPain:n.chestPain||!1,dyspnea:n.dyspnea||!1,trauma:n.trauma||!1,bleeding:n.bleeding||!1,seizures:n.seizures||!1,alteredMentalStatus:n.alteredMentalStatus||!1},d=hr(l),g=dr(l),x=fr(l),w=pr({news:d,mews:g,qsofa:x},l,h),E=await a.prepare(`INSERT INTO triage_assessments (
          patient_id, respiratory_rate, spo2, oxygen_supplementation, oxygen_flow,
          heart_rate, systolic_bp, diastolic_bp, temperature, consciousness_level, gcs_score,
          chest_pain, dyspnea, trauma, bleeding, seizures, altered_mental_status,
          news_score, mews_score, qsofa_score,
          triage_level, triage_color, priority_score,
          immediate_actions, monitoring_plan, investigations_needed, escalation_required,
          assessed_by
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        RETURNING id`).bind(c,r.respiratoryRate,r.spo2,r.oxygenSupplementation?1:0,r.oxygenFlow||null,r.heartRate,r.systolicBP,r.diastolicBP||null,r.temperature,r.consciousnessLevel,r.gcsScore||null,n.chestPain?1:0,n.dyspnea?1:0,n.trauma?1:0,n.bleeding?1:0,n.seizures?1:0,n.alteredMentalStatus?1:0,d,g,x,w.level,w.color,w.priorityScore,JSON.stringify(w.immediateActions),JSON.stringify(w.monitoringPlan),JSON.stringify(w.investigationsNeeded),w.escalationRequired?1:0,i||null).first();return await a.prepare(`INSERT INTO triage_logs (patient_id, assessment_id, action, details, user_id)
         VALUES (?, ?, ?, ?, ?)`).bind(c,(E==null?void 0:E.id)||null,"ASSESSMENT_CREATED",`Triage level: ${w.level}, Priority: ${w.priorityScore}`,i||null).run(),e.json({success:!0,patientId:s.patientId,assessmentId:E==null?void 0:E.id,scores:{news:d,mews:g,qsofa:x},triage:w})}catch(t){return console.error("Error in triage assessment:",t),e.json({error:"Internal server error",details:String(t)},500)}});xe.get("/patients",async e=>{try{const t=e.env.DB,s=parseInt(e.req.query("limit")||"50"),r=parseInt(e.req.query("offset")||"0"),n=await t.prepare(`SELECT 
          p.id, p.patient_id, p.age, p.gender, p.arrival_mode, 
          p.chief_complaint, p.admission_time,
          t.triage_level, t.triage_color, t.priority_score, t.assessment_time,
          t.news_score, t.mews_score, t.qsofa_score
         FROM patients p
         LEFT JOIN triage_assessments t ON p.id = t.patient_id
         WHERE t.id = (
           SELECT id FROM triage_assessments 
           WHERE patient_id = p.id 
           ORDER BY assessment_time DESC 
           LIMIT 1
         )
         ORDER BY t.priority_score DESC, p.admission_time DESC
         LIMIT ? OFFSET ?`).bind(s,r).all();return e.json({success:!0,patients:n.results})}catch(t){return console.error("Error fetching patients:",t),e.json({error:"Internal server error"},500)}});xe.get("/patient/:patientId",async e=>{try{const t=e.req.param("patientId"),s=e.env.DB,r=await s.prepare("SELECT * FROM patients WHERE patient_id = ?").bind(t).first();if(!r)return e.json({error:"Patient not found"},404);const n=await s.prepare(`SELECT * FROM triage_assessments 
         WHERE patient_id = ? 
         ORDER BY assessment_time DESC`).bind(r.id).all(),i=await s.prepare(`SELECT * FROM triage_logs 
         WHERE patient_id = ? 
         ORDER BY timestamp DESC`).bind(r.id).all();return e.json({success:!0,patient:r,assessments:n.results,logs:i.results})}catch(t){return console.error("Error fetching patient details:",t),e.json({error:"Internal server error"},500)}});xe.get("/stats",async e=>{try{const s=await e.env.DB.prepare(`SELECT 
          COUNT(DISTINCT p.id) as total_patients,
          SUM(CASE WHEN t.triage_color = 'red' THEN 1 ELSE 0 END) as red_patients,
          SUM(CASE WHEN t.triage_color = 'orange' THEN 1 ELSE 0 END) as orange_patients,
          SUM(CASE WHEN t.triage_color = 'yellow' THEN 1 ELSE 0 END) as yellow_patients,
          SUM(CASE WHEN t.triage_color = 'green' THEN 1 ELSE 0 END) as green_patients,
          SUM(CASE WHEN t.triage_color = 'blue' THEN 1 ELSE 0 END) as blue_patients,
          AVG(t.news_score) as avg_news,
          AVG(t.mews_score) as avg_mews,
          AVG(t.priority_score) as avg_priority
         FROM patients p
         LEFT JOIN triage_assessments t ON p.id = t.patient_id
         WHERE t.id = (
           SELECT id FROM triage_assessments 
           WHERE patient_id = p.id 
           ORDER BY assessment_time DESC 
           LIMIT 1
         )`).first();return e.json({success:!0,stats:s})}catch(t){return console.error("Error fetching stats:",t),e.json({error:"Internal server error"},500)}});const ve=new Le;ve.use("/api/*",er());ve.use("/static/*",ur({root:"./public"}));ve.route("/api/triage",xe);ve.get("/",e=>e.html(`
    <!DOCTYPE html>
    <html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Анестезиологический Триаж</title>
        <script src="https://cdn.tailwindcss.com"><\/script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
        <style>
          .triage-red { background-color: #ef4444; color: white; }
          .triage-orange { background-color: #f97316; color: white; }
          .triage-yellow { background-color: #fbbf24; color: black; }
          .triage-green { background-color: #22c55e; color: white; }
          .triage-blue { background-color: #3b82f6; color: white; }
        </style>
    </head>
    <body class="bg-gray-50">
        <div id="app"></div>
        <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"><\/script>
        <script src="/static/app.js"><\/script>
    </body>
    </html>
  `));const ze=new Le,gr=Object.assign({"/src/index.tsx":ve});let wt=!1;for(const[,e]of Object.entries(gr))e&&(ze.all("*",t=>{let s;try{s=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,s)}),ze.notFound(t=>{let s;try{s=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,s)}),wt=!0);if(!wt)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{ze as default};
